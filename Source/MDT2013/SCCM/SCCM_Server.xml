<?xml version="1.0"?>
<SmsTaskSequencePackage xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <BootImageID>CEN00006</BootImageID>
  <Category />
  <DependentProgram />
  <Description />
  <Duration>360</Duration>
  <Name>Server Task Sequence</Name>
  <ProgramFlags>152084496</ProgramFlags>
  <SequenceData>
    <sequence version="3.00">
      <referenceList>
        <reference package="CEN00005" />
        <reference package="CEN0000C" />
        <reference package="CEN00003" />
        <reference package="CEN00012" />
      </referenceList>
      <globalVarList>
        <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering">false</variable>
        <variable name="OSDAdapterCount" property="NumAdapters">0</variable>
      </globalVarList>
      <group name="Execute Task Sequence" description="" continueOnError="true">
        <group name="Initialization" description="">
          <group name="Partition if necessary" description="">
            <condition>
              <operator type="or">
                <operator type="and">
                  <expression type="SMS_TaskSequence_VariableConditionExpression">
                    <variable name="Operator">equals</variable>
                    <variable name="Value">TRUE</variable>
                    <variable name="Variable">_SMSTSDownloadOnDemand</variable>
                  </expression>
                  <expression type="SMS_TaskSequence_VariableConditionExpression">
                    <variable name="Operator">equals</variable>
                    <variable name="Value">TRUE</variable>
                    <variable name="Variable">_SMSTSinWinPE</variable>
                  </expression>
                  <expression type="SMS_TaskSequence_VariableConditionExpression">
                    <variable name="Operator">notEquals</variable>
                    <variable name="Value">OEMMedia</variable>
                    <variable name="Variable">_SMSTSMediaType</variable>
                  </expression>
                </operator>
                <operator type="and">
                  <expression type="SMS_TaskSequence_VariableConditionExpression">
                    <variable name="Operator">equals</variable>
                    <variable name="Value">TRUE</variable>
                    <variable name="Variable">_SMSTSinWinPE</variable>
                  </expression>
                  <expression type="SMS_TaskSequence_VariableConditionExpression">
                    <variable name="Operator">equals</variable>
                    <variable name="Value">FullMedia</variable>
                    <variable name="Variable">_SMSTSMediaType</variable>
                  </expression>
                </operator>
              </operator>
            </condition>
            <step type="SMS_TaskSequence_SetVariableAction" name="Set Diskpart BIOS Compatibility Mode" description="" disable="true" runIn="WinPEandFullOS" successCodeList="0">
              <action>tsenv.exe "OSDDiskpartBiosCompatibilityMode=TRUE"</action>
              <defaultVarList>
                <variable name="VariableName" property="VariableName" hidden="true">OSDDiskpartBiosCompatibilityMode</variable>
                <variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk (UEFI)" description="" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">equals</variable>
                  <variable name="Value">true</variable>
                  <variable name="Variable">_SMSTSBootUEFI</variable>
                </expression>
              </condition>
              <action>osddiskpart.exe</action>
              <defaultVarList>
                <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
                <variable name="OSDDiskType" property="DiskType">BASIC</variable>
                <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
                <variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable>
                <variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable>
                <variable name="OSDPartitions" property="Partitions" hidden="true">4</variable>
                <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable>
                <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
                <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
                <variable name="OSDPartitions0Size" property="Partitions0Size">300</variable>
                <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
                <variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable>
                <variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable>
                <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows RE Tools</variable>
                <variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
                <variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">FAT32</variable>
                <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable>
                <variable name="OSDPartitions1Size" property="Partitions1Size">512</variable>
                <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable>
                <variable name="OSDPartitions1Type" property="Partitions1Type">EFI</variable>
                <variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable"></variable>
                <variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">EFI</variable>
                <variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable>
                <variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable>
                <variable name="OSDPartitions2Size" property="Partitions2Size">128</variable>
                <variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">MB</variable>
                <variable name="OSDPartitions2Type" property="Partitions2Type">MSR</variable>
                <variable name="OSDPartitions2VolumeLetterVariable" property="Partitions2VolumeLetterVariable"></variable>
                <variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">MSR</variable>
                <variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">true</variable>
                <variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable>
                <variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable>
                <variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable>
                <variable name="OSDPartitions3Size" property="Partitions3Size">100</variable>
                <variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">PERCENT</variable>
                <variable name="OSDPartitions3Type" property="Partitions3Type">PRIMARY</variable>
                <variable name="OSDPartitions3VolumeLetterVariable" property="Partitions3VolumeLetterVariable">OSDTemporaryDrive</variable>
                <variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">OSDisk</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk" description="" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">true</variable>
                  <variable name="Variable">_SMSTSBootUEFI</variable>
                </expression>
              </condition>
              <action>osddiskpart.exe</action>
              <defaultVarList>
                <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
                <variable name="OSDDiskType" property="DiskType">BASIC</variable>
                <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
                <variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable>
                <variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable>
                <variable name="OSDPartitions" property="Partitions" hidden="true">1</variable>
                <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable>
                <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
                <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
                <variable name="OSDPartitions0Size" property="Partitions0Size">100</variable>
                <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">PERCENT</variable>
                <variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable>
                <variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable">OSDTemporaryDrive</variable>
                <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">OSDisk</variable>
              </defaultVarList>
            </step>
          </group>
          <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
            <defaultVarList>
              <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Check Pre-reqs" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztiprereq.vbs"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztiprereq.vbs"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="BDD_Gather" name="Gather" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>smsswd.exe /run:BDD00006 cscript.exe "%DeployRoot%\Scripts\ZTIGather.wsf"</action>
            <defaultVarList>
              <variable name="GatherLocalOnly" property="GatherLocalOnly">false</variable>
              <variable name="PackageID" property="PackageID" hidden="true">BDD00006</variable>
              <variable name="RulesFile" property="RulesFile">CustomSettings.ini</variable>
            </defaultVarList>
          </step>
        </group>
        <group name="Validation" description="">
          <group name="Non-Replace" description="">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">equals</variable>
                <variable name="Value">False</variable>
                <variable name="Variable">_SMSTSinWinPE</variable>
              </expression>
            </condition>
            <step type="BDD_Validate" name="Validate" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztivalidate.wsf"</action>
              <defaultVarList>
                <variable name="ImageSize" property="ImageSize"></variable>
                <variable name="ImageProcessorSpeed" property="ImageProcessorSpeed">800</variable>
                <variable name="ImageMemory" property="ImageMemory">768</variable>
                <variable name="VerifyOS" property="VerifyOS">SERVER</variable>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztivalidate.wsf"</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_RunCommandLineAction" name="Check Bios" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztibioscheck.wsf"</action>
              <defaultVarList>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztibioscheck.wsf"</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
          </group>
        </group>
        <group name="State Capture" description="">
          <condition>
            <expression type="SMS_TaskSequence_VariableConditionExpression">
              <variable name="Operator">equals</variable>
              <variable name="Value">false</variable>
              <variable name="Variable">_SMSTSinWinPE</variable>
            </expression>
          </condition>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Capture Groups" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztigroups.wsf" /capture</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztigroups.wsf" /capture</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_CaptureNetworkSettingsAction" name="Capture Network Settings" description="" runIn="FullOS" successCodeList="0">
            <action>osdnetsettings.exe capture netmembership:%OSDMigrateNetworkMembership% adapters:%OSDMigrateAdapterSettings%</action>
            <defaultVarList>
              <variable name="OSDMigrateAdapterSettings" property="MigrateAdapterSettings">true</variable>
              <variable name="OSDMigrateNetworkMembership" property="MigrateNetworkMembership">false</variable>
            </defaultVarList>
          </step>
        </group>
        <group name="Preinstall" description="">
          <group name="New Computer Only" description="">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">equals</variable>
                <variable name="Value">True</variable>
                <variable name="Variable">_SMSTSinWInPE</variable>
              </expression>
            </condition>
            <step type="SMS_TaskSequence_RunCommandLineAction" name="Validate" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztivalidate.wsf"</action>
              <defaultVarList>
                <variable name="ImageSize" property="ImageSize"></variable>
                <variable name="ImageProcessorSpeed" property="ImageProcessorSpeed">800</variable>
                <variable name="ImageMemory" property="ImageMemory">768</variable>
                <variable name="VerifyOS" property="VerifyOS">SERVER</variable>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztivalidate.wsf"</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_SetVariableAction" name="Set Diskpart BIOS Compatibility Mode" description="" disable="true" runIn="WinPEandFullOS" successCodeList="0">
              <action>tsenv.exe "OSDDiskpartBiosCompatibilityMode=TRUE"</action>
              <defaultVarList>
                <variable name="VariableName" property="VariableName" hidden="true">OSDDiskpartBiosCompatibilityMode</variable>
                <variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_SetVariableAction" name="Set Variable for Format and Partition Disk" description="" runIn="WinPEandFullOS" successCodeList="0">
              <action>tsenv.exe "ImageOSVer=X.X ImageOSVer"</action>
              <defaultVarList>
                <variable name="VariableName" property="VariableName" hidden="true">ImageOSVer</variable>
                <variable name="VariableValue" property="VariableValue" hidden="true">X.X ImageOSVer</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk (UEFI)" description="For Windows 7, Windows Server 2008 R2, and above (UEFI)" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">OEMMedia</variable>
                  <variable name="Variable">_SMSTSMediaType</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">greaterEqual</variable>
                  <variable name="Value">6.1</variable>
                  <variable name="Variable">ImageOSVer</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">equals</variable>
                  <variable name="Value">true</variable>
                  <variable name="Variable">_SMSTSBootUEFI</variable>
                </expression>
              </condition>
              <action>osddiskpart.exe</action>
              <defaultVarList>
                <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
                <variable name="OSDDiskType" property="DiskType">BASIC</variable>
                <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
                <variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable>
                <variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable>
                <variable name="OSDPartitions" property="Partitions" hidden="true">4</variable>
                <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable>
                <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
                <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
                <variable name="OSDPartitions0Size" property="Partitions0Size">300</variable>
                <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
                <variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable>
                <variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable>
                <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows RE Tools</variable>
                <variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
                <variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">FAT32</variable>
                <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable>
                <variable name="OSDPartitions1Size" property="Partitions1Size">512</variable>
                <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable>
                <variable name="OSDPartitions1Type" property="Partitions1Type">EFI</variable>
                <variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable"></variable>
                <variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">EFI</variable>
                <variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">false</variable>
                <variable name="OSDPartitions2Bootable" property="Partitions2Bootable">false</variable>
                <variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable>
                <variable name="OSDPartitions2Size" property="Partitions2Size">128</variable>
                <variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">MB</variable>
                <variable name="OSDPartitions2Type" property="Partitions2Type">MSR</variable>
                <variable name="OSDPartitions2VolumeLetterVariable" property="Partitions2VolumeLetterVariable"></variable>
                <variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">MSR</variable>
                <variable name="OSDPartitions3AssignVolumeLetter" property="Partitions3AssignVolumeLetter">true</variable>
                <variable name="OSDPartitions3Bootable" property="Partitions3Bootable">false</variable>
                <variable name="OSDPartitions3FileSystem" property="Partitions3FileSystem">NTFS</variable>
                <variable name="OSDPartitions3QuickFormat" property="Partitions3QuickFormat">true</variable>
                <variable name="OSDPartitions3Size" property="Partitions3Size">100</variable>
                <variable name="OSDPartitions3SizeUnits" property="Partitions3SizeUnits">PERCENT</variable>
                <variable name="OSDPartitions3Type" property="Partitions3Type">PRIMARY</variable>
                <variable name="OSDPartitions3VolumeLetterVariable" property="Partitions3VolumeLetterVariable">OSDisk</variable>
                <variable name="OSDPartitions3VolumeName" property="Partitions3VolumeName">OSDisk</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk 6.1" description="For Windows 7, Windows Server 2008 R2, and above" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">OEMMedia</variable>
                  <variable name="Variable">_SMSTSMediaType</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">greaterEqual</variable>
                  <variable name="Value">6.1</variable>
                  <variable name="Variable">ImageOSVer</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">true</variable>
                  <variable name="Variable">_SMSTSBootUEFI</variable>
                </expression>
              </condition>
              <action>osddiskpart.exe</action>
              <defaultVarList>
                <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
                <variable name="OSDDiskType" property="DiskType">BASIC</variable>
                <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
                <variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable>
                <variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable>
                <variable name="OSDPartitions" property="Partitions" hidden="true">2</variable>
                <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable>
                <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
                <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
                <variable name="OSDPartitions0Size" property="Partitions0Size">499</variable>
                <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
                <variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable>
                <variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable>
                <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">BDEDrive</variable>
                <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
                <variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">NTFS</variable>
                <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable>
                <variable name="OSDPartitions1Size" property="Partitions1Size">100</variable>
                <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">PERCENT</variable>
                <variable name="OSDPartitions1Type" property="Partitions1Type">PRIMARY</variable>
                <variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable">OSDisk</variable>
                <variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">OSDisk</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_PartitionDiskAction" name="Format and Partition Disk 6.0" description="For Windows Vista and Windows Server 2008" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">OEMMedia</variable>
                  <variable name="Variable">_SMSTSMediaType</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">equals</variable>
                  <variable name="Value">6.0</variable>
                  <variable name="Variable">ImageOSVer</variable>
                </expression>
              </condition>
              <action>osddiskpart.exe</action>
              <defaultVarList>
                <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
                <variable name="OSDDiskType" property="DiskType">BASIC</variable>
                <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
                <variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable>
                <variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable>
                <variable name="OSDPartitions" property="Partitions" hidden="true">2</variable>
                <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">true</variable>
                <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
                <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
                <variable name="OSDPartitions0Size" property="Partitions0Size">2</variable>
                <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">GB</variable>
                <variable name="OSDPartitions0Type" property="Partitions0Type">PRIMARY</variable>
                <variable name="OSDPartitions0VolumeLetterVariable" property="Partitions0VolumeLetterVariable"></variable>
                <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">BDEDrive</variable>
                <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
                <variable name="OSDPartitions1FileSystem" property="Partitions1FileSystem">NTFS</variable>
                <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">true</variable>
                <variable name="OSDPartitions1Size" property="Partitions1Size">100</variable>
                <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">PERCENT</variable>
                <variable name="OSDPartitions1Type" property="Partitions1Type">PRIMARY</variable>
                <variable name="OSDPartitions1VolumeLetterVariable" property="Partitions1VolumeLetterVariable">OSDisk</variable>
                <variable name="OSDPartitions1VolumeName" property="Partitions1VolumeName">OSDisk</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_OfflineEnableBitLockerAction" name="Pre-provision BitLocker" description="" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">notEquals</variable>
                  <variable name="Value">YES</variable>
                  <variable name="Variable">BDEInstallSuppress</variable>
                </expression>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">greaterEqual</variable>
                  <variable name="Value">6</variable>
                  <variable name="Variable">OSCurrentVersion</variable>
                </expression>
              </condition>
              <action>OSDOfflineBitlocker.exe /enable  /drive:%OSDisk% /ignoretpm:True</action>
              <defaultVarList>
                <variable name="OSDBitLockerDestinationVariable" property="DestinationVariable" hidden="true">OSDisk</variable>
                <variable name="OSDBitLockerSkipWhenTPMInvalid" property="SkipWhenTPMInvalid" hidden="true">true</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_SetVariableAction" name="Set Variable for Pre-provision BitLocker" description="" runIn="WinPE" successCodeList="0">
              <condition>
                <expression type="SMS_TaskSequence_VariableConditionExpression">
                  <variable name="Operator">exists</variable>
                  <variable name="Value"></variable>
                  <variable name="Variable">OSDBitLockerMode</variable>
                </expression>
              </condition>
              <action>tsenv.exe "IsBDEPreProvisioned=TRUE"</action>
              <defaultVarList>
                <variable name="VariableName" property="VariableName" hidden="true">IsBDEPreProvisioned</variable>
                <variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable>
              </defaultVarList>
            </step>
            <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
              <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
              <defaultVarList>
                <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_RunCommandLineAction" name="Capture Network Settings using MDT" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe %ScriptRoot%\ZTINicConfig.wsf /ForceCapture</action>
              <defaultVarList>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe %ScriptRoot%\ZTINicConfig.wsf /ForceCapture</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
          </group>
        </group>
        <group name="Install" description="">
          <group name="Refresh Only" description="">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">equals</variable>
                <variable name="Value">REFRESH</variable>
                <variable name="Variable">DeploymentType</variable>
              </expression>
            </condition>
            <step type="SMS_TaskSequence_RebootAction" name="Restart to Windows PE" description="" runIn="WinPEandFullOS" successCodeList="0">
              <action>smsboot.exe /target:WinPE</action>
              <defaultVarList>
                <variable name="SMSRebootMessage" property="Message">A new Microsoft Windows operating system is being installed. The computer must restart to continue.</variable>
                <variable name="SMSRebootTimeout" property="MessageTimeout">60</variable>
                <variable name="SMSRebootTarget" property="Target" hidden="true">WinPE</variable>
              </defaultVarList>
            </step>
            <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
              <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
              <defaultVarList>
                <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
              </defaultVarList>
            </step>
            <step type="BDD_Gather" name="Gather" description="" runIn="WinPEandFullOS" successCodeList="0">
              <action>smsswd.exe /run:BDD00006 cscript.exe "%DeployRoot%\Scripts\ZTIGather.wsf"</action>
              <defaultVarList>
                <variable name="GatherLocalOnly" property="GatherLocalOnly">true</variable>
                <variable name="PackageID" property="PackageID" hidden="true">BDD00006</variable>
                <variable name="RulesFile" property="RulesFile">CustomSettings.ini</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_RequestStateStoreAction" name="Request State Store" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
              <action>osdsmpclient.exe /capture</action>
              <defaultVarList>
                <variable name="OSDStateFallbackToNAA" property="FallbackToNAA">true</variable>
                <variable name="OSDStateRequestType" property="RequestType" hidden="true">capture</variable>
                <variable name="OSDStateSMPRetryCount" property="SMPRetryCount" hidden="true">3</variable>
                <variable name="OSDStateSMPRetryTime" property="SMPRetryTime" hidden="true">10</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_RunCommandLineAction" name="Backup" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztibackup.wsf"</action>
              <defaultVarList>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztibackup.wsf"</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_ReleaseStateStoreAction" name="Release State Store" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
              <action>osdsmpclient.exe /release</action>
              <defaultVarList />
            </step>
          </group>
          <step type="SMS_TaskSequence_SetVariableAction" name="Set Variable for Drive Letter" description="Only applicable with ConfigMgr 2012 SP1" runIn="WinPEandFullOS" successCodeList="0">
            <action>tsenv.exe "OSDPreserveDriveLetter=False"</action>
            <defaultVarList>
              <variable name="VariableName" property="VariableName" hidden="true">OSDPreserveDriveLetter</variable>
              <variable name="VariableValue" property="VariableValue" hidden="true">False</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_ApplyOperatingSystemAction" name="Apply Operating System Image" description="" runIn="WinPE" successCodeList="0">
            <action>OSDApplyOS.exe /image:CEN0000C,%OSDImageIndex% "/config:CEN00005,%OSDConfigFileName% /target:%OSDisk%"</action>
            <defaultVarList>
              <variable name="OSDConfigFileName" property="ConfigFileName">unattend.txt</variable>
              <variable name="ConfigFilePackage" property="ConfigFilePackage" hidden="true">CEN00005</variable>
              <variable name="OSDImageIndex" property="ImageIndex">1</variable>
              <variable name="DestinationVariable" property="DestinationVariable" hidden="true">OSDisk</variable>
              <variable name="ImagePackageID" property="ImagePackageID" hidden="true">CEN0000C</variable>
            </defaultVarList>
          </step>
          <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
            <condition>
              <operator type="not">
                <expression type="SMS_TaskSequence_FolderConditionExpression">
                  <variable name="Path">%ScriptRoot%</variable>
                </expression>
              </operator>
            </condition>
            <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
            <defaultVarList>
              <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
            </defaultVarList>
          </step>
        </group>
        <group name="PostInstall" description="">
          <step type="SMS_TaskSequence_ApplyWindowsSettingsAction" name="Apply Windows Settings" description="" runIn="WinPE" successCodeList="0">
            <action>osdwinsettings.exe /config</action>
            <defaultVarList>
              <variable name="OSDComputerName" property="ComputerName">%_SMSTSMachineName%</variable>
              <variable name="OSDProductKey" property="ProductKey">
              </variable>
              <variable name="OSDRandomAdminPassword" property="RandomAdminPassword">true</variable>
              <variable name="OSDRegisteredOrgName" property="RegisteredOrgName">Contoso</variable>
              <variable name="OSDRegisteredUserName" property="RegisteredUserName">Contoso</variable>
              <variable name="OSDServerLicenseConnectionLimit" property="ServerLicenseConnectionLimit">5</variable>
              <variable name="OSDServerLicenseMode" property="ServerLicenseMode">PerSeat</variable>
              <variable name="OSDTimeZone" property="TimeZone">Pacific Standard Time</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_ApplyNetworkSettingsAction" name="Apply Network Settings" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>osdnetsettings.exe configure</action>
            <defaultVarList>
              <variable name="OSDDomainName" property="DomainName">smsdomain</variable>
              <variable name="OSDJoinPassword" property="DomainPassword">password</variable>
              <variable name="OSDJoinAccount" property="DomainUsername">smsdomain\administrator</variable>
              <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering" hidden="true">false</variable>
              <variable name="OSDNetworkJoinType" property="NetworkJoinType">0</variable>
              <variable name="OSDAdapterCount" property="NumAdapters" hidden="true">0</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_AutoApplyAction" name="Auto Apply Drivers" description="" runIn="WinPE" successCodeList="0">
            <action>osddriverclient.exe /auto /bestmatch:%OSDAutoApplyDriverBestMatch% /unsigned:%OSDAllowUnsignedDriver%</action>
            <defaultVarList>
              <variable name="OSDAutoApplyDriverBestMatch" property="BestMatch">true</variable>
              <variable name="OSDAllowUnsignedDriver" property="UnsignedDriver">true</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Configure" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\zticonfigure.wsf"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\zticonfigure.wsf"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_SetupWindowsAndSMSAction" name="Setup Windows and ConfigMgr" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>OSDSetupWindows.exe</action>
            <defaultVarList>
              <variable name="SMSClientInstallProperties" property="ClientInstallProperties">
              </variable>
              <variable name="_SMSClientPackageID" property="ClientPackageID">CEN00003</variable>
            </defaultVarList>
          </step>
        </group>
        <group name="State Restore" description="">
          <step type="SMS_TaskSequence_RebootAction" name="Restart Computer" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>smsboot.exe /target:HD</action>
            <defaultVarList>
              <variable name="SMSRebootMessage" property="Message">
              </variable>
              <variable name="SMSRebootTimeout" property="MessageTimeout">1</variable>
              <variable name="SMSRebootTarget" property="Target" hidden="true">HD</variable>
            </defaultVarList>
          </step>
          <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
            <defaultVarList>
              <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_InstallUpdateAction" name="Install Software Updates" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
            <action>TSInstallSWUpdate.exe /target:%SMSInstallUpdateTarget%</action>
            <defaultVarList>
              <variable name="SMSInstallUpdateTarget" property="Target">All</variable>
            </defaultVarList>
          </step>
          <step type="BDD_Gather" name="Gather" description="" runIn="WinPEandFullOS" successCodeList="0">
            <action>smsswd.exe /run:BDD00006 cscript.exe "%DeployRoot%\Scripts\ZTIGather.wsf"</action>
            <defaultVarList>
              <variable name="GatherLocalOnly" property="GatherLocalOnly">true</variable>
              <variable name="PackageID" property="PackageID" hidden="true">BDD00006</variable>
              <variable name="RulesFile" property="RulesFile">CustomSettings.ini</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Tattoo" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztitatoo.wsf"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztitatoo.wsf"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Opt In to CEIP and WER" disable="true" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztioptin.wsf" /CEIP:YES /WER:YES</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztioptin.wsf" /CEIP:YES /WER:YES</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_EnableBitLockerAction" name="Enable BitLocker" description="" disable="true" runIn="FullOS" successCodeList="0">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">notEquals</variable>
                <variable name="Value">YES</variable>
                <variable name="Variable">BDEInstallSuppress</variable>
              </expression>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">greaterEqual</variable>
                <variable name="Value">6</variable>
                <variable name="Variable">OSCurrentVersion</variable>
              </expression>
            </condition>
            <action>OSDBitLocker.exe /enable  /wait:False /mode:TPM /pwd:AD</action>
            <defaultVarList>
              <variable name="OSDBitLockerCreateRecoveryPassword" property="CreateRecoveryPassword" hidden="true">AD</variable>
              <variable name="OSDBitLockerMode" property="Mode" hidden="true">TPM</variable>
              <variable name="OSDBitLockerWaitForEncryption" property="WaitForEncryption" hidden="true">false</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_InstallSoftwareAction" name="Install Software" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
            <action>smsswd.exe /pkg: /install /basevar:PACKAGES /continueOnError:True</action>
            <defaultVarList>
              <variable name="BaseVariableName" property="BaseVariableName" hidden="true">PACKAGES</variable>
              <variable name="ContinueOnInstallError" property="ContinueOnInstallError" hidden="true">true</variable>
            </defaultVarList>
          </step>
          <group name="Install Applications" description="">
            <step type="SMS_TaskSequence_RunCommandLineAction" name="Convert list to two digits" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
              <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ZTICoalesce.wsf" /CoalescePattern:Applications /CoalesceTarget:CoalescedApps /CoalesceDigits:2</action>
              <defaultVarList>
                <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ZTICoalesce.wsf" /CoalescePattern:Applications /CoalesceTarget:CoalescedApps /CoalesceDigits:2</variable>
                <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
                <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
              </defaultVarList>
            </step>
            <step type="SMS_TaskSequence_InstallApplicationAction" name="Install Application" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
              <action>smsappinstall.exe /app: /basevar:APPLICATIONS /continueOnError:True</action>
              <defaultVarList>
                <variable name="BaseVariableName" property="BaseVariableName" hidden="true">COALESCEDAPPS</variable>
                <variable name="ContinueOnInstallError" property="ContinueOnInstallError" hidden="true">true</variable>
              </defaultVarList>
            </step>
          </group>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Restore Groups" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">notEquals</variable>
                <variable name="Value">YES</variable>
                <variable name="Variable">DOCAPTURE</variable>
              </expression>
            </condition>
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztigroups.wsf" /restore</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztigroups.wsf" /restore</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Move State Store" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztimovestatestore.wsf"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztimovestatestore.wsf"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Apply GPO Pack" description="" continueOnError="true" runIn="FullOS" successCodeList="0">
            <condition>
              <expression type="SMS_TaskSequence_VariableConditionExpression">
                <variable name="Operator">notEquals</variable>
                <variable name="Value">NO</variable>
                <variable name="Variable">APPLYGPOPACK</variable>
              </expression>
            </condition>
            <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztiapplygpopack.wsf"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztiapplygpopack.wsf"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_RunCommandLineAction" name="Copy Logs" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
            <action>smsswd.exe /run: cscript "%deployroot%\scripts\zticopylogs.wsf"</action>
            <defaultVarList>
              <variable name="CommandLine" property="CommandLine" hidden="true">cscript "%deployroot%\scripts\zticopylogs.wsf"</variable>
              <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
              <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
            </defaultVarList>
          </step>
        </group>
        <group name="Capture the Reference Machine" description="">
          <condition>
            <expression type="SMS_TaskSequence_VariableConditionExpression">
              <variable name="Operator">equals</variable>
              <variable name="Value">YES</variable>
              <variable name="Variable">DoCapture</variable>
            </expression>
          </condition>
          <step type="SMS_TaskSequence_InstallDeployToolsAction" name="Install Deployment Tools" description="" runIn="FullOS" successCodeList="0">
            <action>osdprepareos.exe /install:CEN00012</action>
            <defaultVarList>
              <variable name="SysprepPackageID" property="SysprepPackageID" hidden="true">CEN00012</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_PrepareSMSClientAction" name="Prepare ConfigMgr Client" description="" runIn="FullOS" successCodeList="0">
            <action>osdpreparesmsclient.exe</action>
            <defaultVarList />
          </step>
          <step type="SMS_TaskSequence_PrepareOSAction" name="Prepare OS" description="" runIn="FullOS" successCodeList="0">
            <action>osdprepareos.exe /activate:%OSDKeepActivation% /bmsd:%OSDBuildStorageDriverList%</action>
            <defaultVarList>
              <variable name="OSDBuildStorageDriverList" property="BuildStorageDriverList">true</variable>
              <variable name="OSDKeepActivation" property="KeepActivation">false</variable>
            </defaultVarList>
          </step>
          <step type="SMS_TaskSequence_CaptureSystemImageAction" name="Capture the Reference Machine" description="" runIn="WinPE" successCodeList="0">
            <action>osdcapturesystemimage.exe</action>
            <defaultVarList>
              <variable name="OSDCaptureDestination" property="CaptureDestination">\\smsserver\sourceOS$\vistacaptured.wim</variable>
              <variable name="OSDCaptureAccountPassword" property="CapturePassword">password</variable>
              <variable name="OSDCaptureAccount" property="CaptureUsername">smsdomain\administrator</variable>
              <variable name="OSDImageCreator" property="ImageCreator">Administrator</variable>
              <variable name="OSDImageDescription" property="ImageDescription">
              </variable>
              <variable name="OSDImageVersion" property="ImageVersion">
              </variable>
            </defaultVarList>
          </step>
        </group>
      </group>
      <group name="Gather Logs and StateStore on Failure" description="">
        <condition>
          <expression type="SMS_TaskSequence_VariableConditionExpression">
            <variable name="Operator">equals</variable>
            <variable name="Value">false</variable>
            <variable name="Variable">_SMSTSLastActionSucceeded</variable>
          </expression>
        </condition>
        <step type="SMS_TaskSequence_SetVariableAction" name="Set Error Code" description="" runIn="WinPEandFullOS" successCodeList="0">
          <action>tsenv.exe "ErrorReturnCode=%_SMSTSLastActionRetCode%"</action>
          <defaultVarList>
            <variable name="VariableName" property="VariableName" hidden="true">ErrorReturnCode</variable>
            <variable name="VariableValue" property="VariableValue" hidden="true">%_SMSTSLastActionRetCode%</variable>
          </defaultVarList>
        </step>
        <step type="BDD_UsePackage" name="Use Toolkit Package" description="" runIn="WinPEandFullOS" successCodeList="0">
          <condition>
            <operator type="not">
              <expression type="SMS_TaskSequence_FolderConditionExpression">
                <variable name="Path">%ScriptRoot%</variable>
              </expression>
            </operator>
          </condition>
          <action>smsswd.exe /run:CEN00005 cscript.exe Scripts\ZTISCCM.wsf</action>
          <defaultVarList>
            <variable name="BDDPackageID" property="PackageID" hidden="true">CEN00005</variable>
          </defaultVarList>
        </step>
        <step type="BDD_Gather" name="Gather" description="" runIn="WinPEandFullOS" successCodeList="0">
          <action>smsswd.exe /run:CEN00018 cscript.exe "%DeployRoot%\Scripts\ZTIGather.wsf"</action>
          <defaultVarList>
            <variable name="GatherLocalOnly" property="GatherLocalOnly">false</variable>
            <variable name="PackageID" property="PackageID" hidden="true">CEN00018</variable>
            <variable name="RulesFile" property="RulesFile">CustomSettings.ini</variable>
          </defaultVarList>
        </step>
        <step type="SMS_TaskSequence_RunCommandLineAction" name="Move State Store" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
          <action>smsswd.exe /run: cscript.exe "%deployroot%\scripts\ztimovestatestore.wsf"</action>
          <defaultVarList>
            <variable name="CommandLine" property="CommandLine" hidden="true">cscript.exe "%deployroot%\scripts\ztimovestatestore.wsf"</variable>
            <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
            <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
          </defaultVarList>
        </step>
        <step type="SMS_TaskSequence_RunCommandLineAction" name="Copy Logs" description="" runIn="WinPEandFullOS" successCodeList="0 3010">
          <action>smsswd.exe /run: cscript "%deployroot%\scripts\zticopylogs.wsf"</action>
          <defaultVarList>
            <variable name="CommandLine" property="CommandLine" hidden="true">cscript "%deployroot%\scripts\zticopylogs.wsf"</variable>
            <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
            <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable>
          </defaultVarList>
        </step>
        <step type="SMS_TaskSequence_RunCommandLineAction" name="Error in the task sequence" description="" runIn="WinPEandFullOS" successCodeList="0">
          <action>smsswd.exe /run: cscript "%deployroot%\scripts\ztierrormsg.wsf"</action>
          <defaultVarList>
            <variable name="CommandLine" property="CommandLine" hidden="true">cscript "%deployroot%\scripts\ztierrormsg.wsf"</variable>
            <variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable>
            <variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable>
            <variable name="SuccessCodes" property="SuccessCodes" hidden="true">0</variable>
          </defaultVarList>
        </step>
      </group>
    </sequence>
  </SequenceData>
  <SourceDate>2007-07-20T10:21:30</SourceDate>
  <SupportedOperatingSystems />
  <IconSize>0</IconSize>
</SmsTaskSequencePackage>
